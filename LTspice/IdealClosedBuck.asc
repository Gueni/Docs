Version 4
SHEET 1 908 680
WIRE -16 -64 -16 -80
WIRE 240 -64 240 -80
WIRE 240 32 240 16
WIRE -288 64 -384 64
WIRE -48 64 -288 64
WIRE -384 112 -384 64
WIRE -288 128 -288 64
WIRE -96 144 -192 144
WIRE -48 176 -48 160
WIRE -16 176 -48 176
WIRE 208 176 208 144
WIRE 208 176 144 176
WIRE 240 176 208 176
WIRE 144 192 144 176
WIRE -288 224 -288 192
WIRE -48 224 -48 176
WIRE -48 224 -192 224
WIRE -384 240 -384 192
WIRE 240 240 240 176
WIRE -48 256 -48 224
WIRE 144 288 144 272
WIRE -48 352 -48 320
WIRE 240 352 240 320
WIRE -320 384 -320 368
FLAG -384 240 0
FLAG -288 224 0
FLAG 144 352 0
FLAG 240 352 0
FLAG -48 352 0
FLAG 208 144 out
FLAG -16 16 0
FLAG -16 -80 err
FLAG 240 32 0
FLAG 240 -80 Ctr
FLAG -320 464 0
FLAG -320 368 Tri
SYMBOL voltage -384 96 R0
SYMATTR InstName Vin
SYMATTR Value 20
SYMBOL nmos -96 64 R0
SYMATTR InstName M1
SYMATTR Value Si7336ADP
SYMBOL cap -304 128 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL ind 80 160 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName L1
SYMATTR Value 4.7µ
SYMBOL cap 128 288 R0
SYMATTR InstName C2
SYMATTR Value 66µ
SYMBOL res 128 176 R0
SYMATTR InstName R1
SYMATTR Value 10m
SYMBOL res 160 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10m
SYMBOL res 224 224 R0
SYMATTR InstName R3
SYMATTR Value R=if(time>1m,if(time<5m,5,1),1k)
SYMBOL bv -192 128 R0
WINDOW 3 -55 260 Left 2
SYMATTR InstName B1
SYMATTR Value V=IF(V(Ctr)>V(Tri),5,0)
SYMBOL bv -16 -80 R0
SYMATTR InstName B2
SYMATTR Value V={Ref}-V(out)
SYMBOL bv 240 -80 R0
SYMATTR InstName B3
SYMATTR Value V=Kp*V(err)+Ki*idt(V(err))
SYMBOL voltage -320 368 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE(0 5 0 {1/(2*Fs)} {1/(2*Fs)} 0 {1/(Fs)})
SYMBOL diode -32 320 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
TEXT -416 -96 Left 2 !.param Fs=250k\n.param Ref=10\n.param Kp= 20\n.param Ki=250\n.tran 15ms startup
TEXT 32 80 Left 2 !.ic V(out)=0
TEXT 120 -152 Left 2 ;KI CORRECTS THE STEADY STATE ERROR
